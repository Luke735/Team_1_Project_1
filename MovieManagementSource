#include <iostream>
#include <fstream>
#include <iomanip>
#include <string>
#include <list>
#include <iterator>
#include <vector>
#include "Movie.h"
using namespace std;

int main() {

    ifstream fin("movie.txt");

    if (!fin.is_open()) {
        cout << "Could not open file" << endl;
    }
    else {
        ofstream fout;
        fout.open("results_1.txt");
        list<Movie> showingList, comingList;
        vector<string> names, release_dates, receive_dates, descriptions, statuses;
        string line;
        while (getline(fin, line)) {
            string name = "", release_date = "", description = "", receive_date = "", status = "";
            int count = 0, breaker = 0;
            for (count; count < line.size(); count++) {
                char current;
                current = line.at(count);
                if (current == ',') {
                    ++breaker;
                    continue;
                }
                if (breaker == 0) {
                    name.push_back(current);
                }
                if (breaker == 1 && current != ' ') {
                    release_date.push_back(current);
                }
                if (breaker == 2 && current != ' ') {
                    description.push_back(current);
                }
                if (breaker == 3 && current != ' ') {
                    receive_date.push_back(current);
                }
                if (breaker == 4 && current != ' ') {
                    status.push_back(current);
                }
            }
            names.push_back(name);
            release_dates.push_back(release_date);
            receive_dates.push_back(receive_date);
            descriptions.push_back(description);
            statuses.push_back(status);

            Date newReceiveDate = Date();
            newReceiveDate.set_day(stoi(receive_date.substr(0, 3)));
            newReceiveDate.set_month(stoi(receive_date.substr(3, 6)));
            newReceiveDate.set_year(stoi(receive_date.substr(6)));

            Date newReleaseDate = Date();
            newReleaseDate.set_day(stoi(release_date.substr(0, 3)));
            newReleaseDate.set_month(stoi(release_date.substr(3, 6)));
            newReleaseDate.set_year(stoi(release_date.substr(6)));

            bool statuss = false;
            if (status == "1") { statuss = true; }
            Movie newMovie = Movie(name, newReleaseDate, description, newReceiveDate, statuss);
            showingList.push_back(newMovie);
            cout << newMovie << endl; 
        }

        string option = "e";
        //the menu is in a while loop until the option selected is q
        //the menu only reads the first character of the input as the option
        while (option.at(0) != 'q') {
            cout << "MENU" << endl;
            cout << "a - Display movies" << endl;
            cout << "b - Add movies" << endl;
            cout << "c - Edit release dates" << endl;
            cout << "d - Edit movie description" << endl;
            cout << "e - Start showing movies in the theatre" << endl;
            cout << "f - Number of movies before a date" << endl;
            cout << "s - Save" << endl;
            cout << "q - Quit" << endl;
            cout << endl;
            cout << "Choose an option: " << endl;
            cin >> option;

            //explain option here
            if (option.at(0) == 'a') {
                list<Movie>::iterator it;
                for (it = showingList.begin(); it != showingList.end(); ++it) {
                    cout << *it << endl;
                }
            }
            //explain option here
            if (option.at(0) == 'b') {
                string newName, newDescription;
                string newStatusStr;
                bool newStatusBool;
                Date newReceiveDate = Date();
                Date newReleaseDate = Date();
                string dateInput;

                cout << "Enter the movie's name";
                cin.ignore();
                getline(cin, newName);
              
                cout << "Enter the movie's release date day" << endl;
                cin >> dateInput;
                newReleaseDate.set_day(stoi(dateInput.substr(0, 2)));
                cout << "Enter the movie's release date month" << endl;
                cin >> dateInput;
                newReleaseDate.set_month(stoi(dateInput.substr(0, 2)));
                cout << "Enter the movie's release date year" << endl;
                cin >> dateInput;
                newReleaseDate.set_year(stoi(dateInput.substr(0, 2)));

                cout << "Enter the movie's description" << endl;
                cin.ignore();
                getline(cin, newDescription);

                cout << "Enter the movie's receive date day" << endl;
                cin >> dateInput;
                newReceiveDate.set_day(stoi(dateInput.substr(0, 2)));
                cout << "Enter the movie's receive date month" << endl;
                cin >> dateInput;
                newReceiveDate.set_month(stoi(dateInput.substr(0, 2)));
                cout << "Enter the movie's receive date year" << endl;
                cin >> dateInput;
                newReceiveDate.set_year(stoi(dateInput.substr(0, 2)));

                cout << "Is the movie showing (enter 1) or coming (enter 0)" << endl;
                cin >> newStatusStr;
                if (newStatusStr.at(0) == '1') { newStatusBool = true; }
                else { newStatusBool = false; }
                
                Movie newMovie = Movie(newName, newReleaseDate, newDescription, newReceiveDate, newStatusBool);
                showingList.push_back(newMovie);
            }
            //explain option here
            if (option.at(0) == 'c') {

            }
            //explain option here
            if (option.at(0) == 'd') {

            }
            //explain option here
            if (option.at(0) == 'e') {

            }
            //explain option here
            if (option.at(0) == 'f') {

            }
            //explain option here
            if (option.at(0) == 's') {

            }
        }//end while loop
        fin.close();
        fout.close();
    }
    return 0;
}
